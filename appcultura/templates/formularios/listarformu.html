{% extends 'admin/inicio.html' %}
{% block content %}

<main id="main" class="main">

    <div class="pagetitle">
      <h1>Listado de Formularios</h1>
      <nav>
        <ol class="breadcrumb">
          <li class="breadcrumb-item"><a href="#">Inicio</a></li>
          <li class="breadcrumb-item active">Listado</li>
        </ol>
      </nav>
    </div><!-- End Page Title -->

    <section class="section dashboard">
      <div class="row">
       <!--registro de cursos forms-->   
       <div class="col-lg-12">
        <div class="card">
            <div class="card-body">
              <div class="mt-3">
                <a type="button" class="btn btn-primary" href="{% url 'crearformu' %}"> Agregar </a>
              </div>
              <br>
               <!--alertar-->
               {% if newmensaje %}
                <div class="alert alert-warning alert-dismissible fade show" role="alert">
                    <strong>{{ newmensaje }}</strong>
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
               {% endif %}
               <!--end alertar-->
               <!-- Table with stripped rows -->
               <div class="table-responsive">
               <table class="table" id="tablareactiva">
                <thead>
                  <tr>
                    <th>Nombre</th>
                    <th>Descripción</th>
                    <th>Fecha</th>
                    <th>Vincular</th>
                    <th>Acciones</th>
                  </tr>
                </thead>
                <tbody>
                  {% for f in formu %}
                   <tr>
                    <td>{{f.nombre}}</td>
                    <td>{{f.descrip}}</td>
                    
                    <td>{{f.fecha|date:"m/d/Y"}}</td>
                    
                      </td>
                    <td>
                      <!--vincular el formulario con diferentes cursos y sesiones-->
                      <!-- Button trigger modal -->
                      <a type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#vincularModal{{f.id}}">
                        <i class="bi bi-card-checklist"></i>
                      </a>

                      <!-- Modal -->
                      <div class="modal fade" id="vincularModal{{f.id}}" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                        <div class="modal-dialog modal-lg">
                          <div class="modal-content">
                            <div class="modal-header">
                              <h1 class="modal-title fs-5" id="exampleModalLabel">Vincular formularios a sesiones de curso</h1>
                              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                              <!--codigo para ver las sesiones-->
                              <form action="{% url 'addsesionform' idform=f.id %}" method="post">
                                {% csrf_token %}
                              <div class="table-responsive">
                                <table class="table table-bordered">
                                  <thead class="table-info">
                                      <tr>
                                          <th>Curso</th>
                                          <th>Sesión</th>
                                          <th>Fecha de Inicio</th>
                                          <th>Lugar</th>
                                          <th>Seleccionar</th>
                                          <th>Compartir</th>
                                      </tr>
                                  </thead>
                                  <tbody>
                                      {% for curso, sesiones in cursos_sesiones.items %}
                                          {% for sesion in sesiones %}
                                              <tr>
                                                  {% if forloop.first %}  <!-- Para la primera fila del curso -->
                                                      <td rowspan="{{ sesiones|length }}">{{ curso.nombre }}</td>
                                                  {% endif %}
                                                  <td>{{ forloop.counter }}</td>  <!-- Número de sesión -->
                                                  <td>{{ sesion.fechainicio|date:"m/d/Y g:iA" }}</td>
                                                  <td>{{ sesion.lugar }}</td>
                                                  <td>
                                                  <div class="text-center">
                                                      <input class="form-check-input" type="checkbox" id="sesionCurso[]" name="sesionCurso[]" value="{{sesion.id}}" style="border: 1px solid rgb(20, 20, 20);"  {% for agregado in agregados %}{% if agregado.idform.id == f.id %} {% if agregado.idsesion.id == sesion.id %} checked {% endif %} {% endif %} {% endfor %}>
                                                  </div>
                                                    <!--end botones-->
                                                  </td>
                                                  <td><a class="btn btn-primary" href="{% url 'qrformu' idsesion=sesion.id %}" role="button" target="_blank"><i class="bi bi-share-fill"></i></a>
                                              </tr>
                                          {% endfor %}
                                      {% endfor %}
                                  </tbody>
                              </table>
                            </div>
                            <!--end codigo sesiones-->
                            </div>
                            <div class="modal-footer">
                              <button type="button" class="btn btn-warning" data-bs-dismiss="modal">Salir</button>
                              <button type="submit" class="btn btn-primary">Guardar</button>
                            </div>
                          </form>
                          </div>
                        </div>
                      </div>
                      <!--end vincular formularios-->
                    </td>
                    <td>
                        <a href="{% url 'copiarform' idform=f.id %}"  class="btn btn-success"><i class="bi bi-copy"></i></a>
                        <a href="{% url 'editarform' idform=f.id %}"  class="btn btn-info"><i class="bi bi-eye-fill"></i></a>
                        <a type="button" class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#eliminarModal{{f.id}}">
                          <i class="bi bi-trash3-fill"></i>
                        </a>
                        <!-- Modal -->
                        <div class="modal fade" id="eliminarModal{{f.id}}" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                          <div class="modal-dialog">
                            <div class="modal-content">
                              <div class="modal-header">
                                <h1 class="modal-title fs-5" id="exampleModalLabel">Alerta</h1>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                              </div>
                              <div class="modal-body">
                                ¿Esta seguro que desea eliminar este formulario?
                              </div>
                              <div class="modal-footer">
                                <button type="button" class="btn btn-warning" data-bs-dismiss="modal">No</button>
                                <a type="button" class="btn btn-danger"  href="{% url 'eliminarForm' idform=f.id %}">Si</a>
                              </div>
                            </div>
                          </div>
                        </div>
                        <!--end modal-->
                    </td>
                   </tr>
                   {% endfor %}
                </tbody>
              </table>
              <!-- End Table with stripped rows -->
               </div>
            </div>
          </div>
       </div>
      </div>
    </section>
</main><!-- End #main -->
  <!-- Aqui se encuentran las instrucciones para formularios -->
  {% endblock %} 